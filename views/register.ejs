<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>job Application</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <center>
      <h2>PATEL DHYEY</h2>
      <h2>24DEV054</h2>
    </center>
    <section
      class="card position-absolute top-50 start-50 translate-middle my-2"
      style="width: 375px; height: 550px; background-color: #76abae"
    >
      <div id="error" class="m-2" style="height: 3px"></div>
      <div class="position-absolute top-50 start-50 translate-middle">
        <form id="form">
          <h3 class="text-center fs-1"><b> Register </b></h3>
          <label for="f_name">First name* :</label>
          <input
            type="text"
            name="f_name"
            id="f_name"
            tabindex="1"
          /><br /><br />
          <label for="l_name">Last name* :</label>
          <input
            type="text"
            name="l_name"
            id="l_name"
            tabindex="2"
          /><br /><br />
          <label for="email">Email* :</label>
          <input
            type="text"
            name="email"
            id="email"
            tabindex="3"
            placeholder="abc@xyz.com"
            minlength="10"
          /><br /><br />
          <label for="Mobile_no">Mobile_no* :</label>
          <input
            type="tel"
            name="Mobile_no"
            id="Mobile_no"
            tabindex="4"
            length="10"
          /><br /><br />
          <input
            type="button"
            class="btn btn-dark"
            onclick="btn()"
            value="Register"
          />
        </form>
        <div
          id="timer"
          class="position-absolute top-100 start-50 translate-middle my-2"
          style="height: 3px"
        ></div>
      </div>
    </section>
    <div
      id="link"
      class="d-flex justify-content-center"
      style="margin-top: 510px; margin-bottom: 10px"
    ></div>
    <script>
      var error = document.getElementById("error");
      var timer;
      const btn = async () => {
        let valid = validation();
        console.log(valid);
        if (valid.length > 0) {
          error.style.display = "block";
          error.innerHTML = `<div class="alert alert-danger"> ENTER VALID ${valid.toUpperCase()} ....<div>`;
        } else {
          // alert("data recived...");
          error.style.display = "none";
          await fetch("http://localhost:8000/user/register", {
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            method: "post",
            body: new URLSearchParams(
              new FormData(document.getElementById("form"))
            ),
          })
            .then(async (e) => {
              // alert("data recived...");
              if (e.status == 404) {
                let err = await e.json();
                error.style.display = "block";
                error.innerHTML = `<div class="alert alert-danger text-center">${err["error"]} ....<div>`;
                document.getElementById(err["error"]).focus();
              } else if (e.status == 400) {
                let err = await e.json();
                error.style.display = "block";
                error.innerHTML = `<div class="alert alert-danger text-center">${err["error"]} ....<div>`;
                document.getElementById(
                  "link"
                ).innerHTML = `<div class="btn btn-outline-success"><a class="link-dark text-decoration-none" href="/user/forgotpassword">Forgot password</a><div>`;
              } else if (e.status == 200) {
                error.style.display = "block";
                error.innerHTML = `<div class="alert alert-success text-center"> Data recived ....</div>`;
                let res = await e.json();
                let code = res.code;
                let codelink = `http://localhost:8000/user/register?token=${code}`;
                document.getElementById(
                  "link"
                ).innerHTML = `<div class="btn btn-outline-success"><a class="link-dark text-decoration-none" href="${codelink}">${codelink}</a><div>`;
                let time = 60;
                clearInterval(timer);
                timer = setInterval(() => {
                  if (time > 0) {
                    time--;
                    document.getElementById(
                      "timer"
                    ).innerHTML = `<div class="alert alert-success text-center"n style="width: 250px">Register Time left : ${time}</div>`;
                  }
                }, 1000);
                console.log(timer);
                setTimeout(() => {
                  document.getElementById("link").innerHTML = ``;
                }, 60 * 1000);
              }
            })
            .catch((e) => {
              console.log(e);
            });
        }
      };
      const validation = () => {
        let form = new FormData(document.getElementById("form"));
        let formdata = Object.fromEntries(form);
        let formtitles = Object.keys(formdata);
        let mailformat = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
        let valid = true;
        let errortitle = "";
        for (let title of formtitles) {
          if (formdata[title] == "") {
            errortitle = title;
            valid = false;
            break;
          } else if (title == "f_name" || title == "l_name") {
            if (
              formdata[title].includes("0") ||
              formdata[title].includes("1") ||
              formdata[title].includes("2") ||
              formdata[title].includes("3") ||
              formdata[title].includes("4") ||
              formdata[title].includes("5") ||
              formdata[title].includes("6") ||
              formdata[title].includes("7") ||
              formdata[title].includes("8") ||
              formdata[title].includes("9")
            ) {
              errortitle = title;
              valid = false;
              break;
            }
          } else if (title == "email") {
            if (!formdata[title].match(mailformat)) {
              errortitle = title;
              valid = false;
              break;
            }
          }
          if (title == "Mobile_no" && formdata[title].length != 10) {
            errortitle = title;
            valid = false;
            break;
          }
        }
        errortitle.length > 0
          ? document.getElementById(errortitle).focus()
          : "";
        // console.log(formdata);
        return errortitle;
      };
    </script>
  </body>
</html>
